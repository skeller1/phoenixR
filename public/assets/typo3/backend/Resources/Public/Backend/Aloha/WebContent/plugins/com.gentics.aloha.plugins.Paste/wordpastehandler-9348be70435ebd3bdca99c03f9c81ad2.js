/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
/**
 * Register the word paste handler
 */
GENTICS.Aloha.PastePlugin.WordPasteHandler=new GENTICS.Aloha.PastePlugin.PasteHandler,GENTICS.Aloha.PastePlugin.WordPasteHandler.handlePaste=function(a){this.detectWordContent(a)&&this.transformWordContent(a)},GENTICS.Aloha.PastePlugin.WordPasteHandler.detectWordContent=function(a){var b=!1;return a.find("*").each(function(){var a=jQuery(this).attr("style");if(a&&a.toLowerCase().indexOf("mso")>=0)return b=!0,!1;var c=jQuery(this).attr("class");if(c&&c.toLowerCase().indexOf("mso")>=0)return b=!0,!1}),b},GENTICS.Aloha.PastePlugin.WordPasteHandler.isOrderedList=function(a){return a.css("fontFamily")=="Wingdings"||a.css("fontFamily")=="Symbol"?!1:a.text().match(/^([0-9]{1,3}\.)|([0-9]{1,3}\)|([a-zA-Z]{1,5}\.)|([a-zA-Z]{1,5}\)))$/)?!0:!1},GENTICS.Aloha.PastePlugin.WordPasteHandler.transformListsFromWord=function(a){var b=this,c="aloha-list-element",d="aloha-list-bullet",e="p.MsoListParagraphCxSpFirst,p.MsoListParagraph,p span",f=a.find(e);f.each(function(){var a=jQuery(this);a.hasClass("MsoListParagraphCxSpFirst")||a.hasClass("MsoListParagraph")?a.addClass(c):a.css("font-family").indexOf("Symbol")>=0?a.closest("p").addClass(c):a.css("mso-list")&&a.css("mso-list")!=""&&a.closest("p").addClass(c)}),e="p span span span";var g=a.find(e);g.each(function(){var a=jQuery(this),b=a.text().trim().replace(/&nbsp;/g,"");if(b.length==0){var e=a.parent().parent().text().trim().replace(/&nbsp;/g,"");e.match(/^([0-9]{1,3}\.)|([0-9]{1,3}\)|([a-zA-Z]{1,5}\.)|([a-zA-Z]{1,5}\)))$/)&&(a.closest("p").addClass(c),a.parent().parent().addClass(d))}}),e="p."+c;var h=":not("+e+")";f=a.find(e),f.length>0&&f.each(function(){var a=jQuery(this);a.removeClass(c),a.find("font").each(function(){jQuery(this).contents().unwrap()});var e=0,f=parseFloat(a.css("marginLeft")),g=[],i=a.nextUntil(h),j=jQuery(a.find("span."+d));j.length==0&&(j=jQuery(a.children("span:first")));var k=b.isOrderedList(j);j.remove();var l=jQuery(k?"<ol></ol>":"<ul></ul>");g.push(l);var m=jQuery("<li></li>");l.append(m),a.contents().appendTo(m),a.replaceWith(l),i.each(function(){var a=jQuery(this);a.find("font").each(function(){jQuery(this).contents().unwrap()});var c=parseFloat(a.css("marginLeft"));j=jQuery(a.find("span."+d)),j.length==0&&(j=jQuery(a.children("span:first"))),k=b.isOrderedList(j),j.remove();if(c>f){var h=jQuery(k?"<ol></ol>":"<ul></ul>");l.children(":last").append(h),l=h,g.push(l),e++,f=c}else c<f&&e>0&&(g.pop(),e--,l=g[e],f=c);m=jQuery("<li></li>"),l.append(m),a.contents().appendTo(m),a.remove()})})},GENTICS.Aloha.PastePlugin.WordPasteHandler.transformTitles=function(a){a.find("p.MsoTitle").each(function(){GENTICS.Aloha.Markup.transformDomObject(jQuery(this),"h1")}),a.find("p.MsoSubtitle").each(function(){GENTICS.Aloha.Markup.transformDomObject(jQuery(this),"h2")})},GENTICS.Aloha.PastePlugin.WordPasteHandler.transformTables=function(a){a.find("table").each(function(){jQuery(this).removeAttr("border").removeAttr("cellspacing").removeAttr("cellpadding")}),a.find("td").each(function(){jQuery(this).removeAttr("width").removeAttr("height").removeAttr("valign")})},GENTICS.Aloha.PastePlugin.WordPasteHandler.transformFormattings=function(a){a.find("strong,em,s,u").each(function(){this.nodeName.toLowerCase()=="strong"?GENTICS.Aloha.Markup.transformDomObject(jQuery(this),"b"):this.nodeName.toLowerCase()=="em"?GENTICS.Aloha.Markup.transformDomObject(jQuery(this),"i"):this.nodeName.toLowerCase()=="s"?GENTICS.Aloha.Markup.transformDomObject(jQuery(this),"del"):this.nodeName.toLowerCase()=="u"&&jQuery(this).contents().unwrap()})},GENTICS.Aloha.PastePlugin.WordPasteHandler.removeComments=function(a){a.contents().each(function(){this.nodeType==8&&jQuery(this).remove()})},GENTICS.Aloha.PastePlugin.WordPasteHandler.unwrapTags=function(a){a.find("span,font,div").each(function(){jQuery(this).contents().unwrap()})},GENTICS.Aloha.PastePlugin.WordPasteHandler.removeStyles=function(a){a.find("*").each(function(){jQuery(this).removeAttr("style").removeClass()})},GENTICS.Aloha.PastePlugin.WordPasteHandler.removeNamespacedElements=function(a){a.find("*").each(function(){var a=this.prefix?this.prefix:this.scopeName?this.scopeName:undefined;a&&a!="HTML"&&jQuery(this).remove()})},GENTICS.Aloha.PastePlugin.WordPasteHandler.transformWordContent=function(a){this.transformListsFromWord(a),this.transformTables(a),this.transformTitles(a),this.removeComments(a),this.unwrapTags(a),this.removeStyles(a),this.removeNamespacedElements(a),this.transformFormattings(a)}