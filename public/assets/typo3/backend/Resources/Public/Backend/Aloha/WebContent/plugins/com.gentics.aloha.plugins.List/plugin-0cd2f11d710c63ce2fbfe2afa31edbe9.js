/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
/**
 * Register the ListPlugin as GENTICS.Aloha.Plugin
 */
GENTICS.Aloha.ListPlugin=new GENTICS.Aloha.Plugin("com.gentics.aloha.plugins.List"),GENTICS.Aloha.ListPlugin.languages=["en","de","fr","eo","fi","ru","it"],GENTICS.Aloha.ListPlugin.config=["ul","ol"],GENTICS.Aloha.ListPlugin.transformableElements={p:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,ul:!0,ol:!0},GENTICS.Aloha.ListPlugin.init=function(){var a=this;this.createUnorderedListButton=new GENTICS.Aloha.ui.Button({iconClass:"GENTICS_button GENTICS_button_ul",size:"small",tooltip:this.i18n("button.createulist.tooltip"),toggle:!0,onclick:function(b,c){a.transformList(!1)}}),GENTICS.Aloha.FloatingMenu.addButton("GENTICS.Aloha.continuoustext",this.createUnorderedListButton,GENTICS.Aloha.i18n(GENTICS.Aloha,"floatingmenu.tab.format"),1),this.createOrderedListButton=new GENTICS.Aloha.ui.Button({iconClass:"GENTICS_button GENTICS_button_ol",size:"small",tooltip:this.i18n("button.createolist.tooltip"),toggle:!0,onclick:function(b,c){a.transformList(!0)}}),GENTICS.Aloha.FloatingMenu.addButton("GENTICS.Aloha.continuoustext",this.createOrderedListButton,GENTICS.Aloha.i18n(GENTICS.Aloha,"floatingmenu.tab.format"),1),GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"selectionChanged",function(b,c){a.createUnorderedListButton.setPressed(!1),a.createOrderedListButton.setPressed(!1);for(var d=0;d<c.markupEffectiveAtStart.length;d++){var e=c.markupEffectiveAtStart[d];if(GENTICS.Aloha.Selection.standardTextLevelSemanticsComparator(e,jQuery("<ul></ul>"))){a.createUnorderedListButton.setPressed(!0);break}if(GENTICS.Aloha.Selection.standardTextLevelSemanticsComparator(e,jQuery("<ol></ol>"))){a.createOrderedListButton.setPressed(!0);break}}GENTICS.Aloha.activeEditable&&a.applyButtonConfig(GENTICS.Aloha.activeEditable.obj),GENTICS.Aloha.FloatingMenu.doLayout()}),GENTICS.Aloha.Markup.addKeyHandler(9,function(b){return a.processTab(b)})},GENTICS.Aloha.ListPlugin.applyButtonConfig=function(a){var b=this.getEditableConfig(a);GENTICS.Aloha.Selection.rangeObject.unmodifiableMarkupAtStart[0]&&(jQuery.inArray("ul",b)!=-1&&GENTICS.Aloha.Selection.canTag1WrapTag2(GENTICS.Aloha.Selection.rangeObject.unmodifiableMarkupAtStart[0].nodeName,"ul")!=-1?this.createUnorderedListButton.show():this.createUnorderedListButton.hide(),jQuery.inArray("ol",b)!=-1&&GENTICS.Aloha.Selection.canTag1WrapTag2(GENTICS.Aloha.Selection.rangeObject.unmodifiableMarkupAtStart[0].nodeName,"ol")!=-1?this.createOrderedListButton.show():this.createOrderedListButton.hide())},GENTICS.Aloha.ListPlugin.processTab=function(a){switch(a.keyCode){case 9:return a.shiftKey?this.outdentList():this.indentList()}return!0},GENTICS.Aloha.ListPlugin.getStartingDomObjectToTransform=function(){var a=GENTICS.Aloha.Selection.rangeObject;for(var b=0;b<a.markupEffectiveAtStart.length;b++){var c=a.markupEffectiveAtStart[b];if(this.transformableElements[c.nodeName.toLowerCase()])return c}return!1},GENTICS.Aloha.ListPlugin.getNearestSelectedListItem=function(){var a=GENTICS.Aloha.Selection.rangeObject;for(var b=0;b<a.markupEffectiveAtStart.length;b++){var c=a.markupEffectiveAtStart[b];if(GENTICS.Utils.Dom.isListElement(c))return c}return!1},GENTICS.Aloha.ListPlugin.transformList=function(a){var b=this.getStartingDomObjectToTransform();if(!b){GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<p></p>")),b=this.getStartingDomObjectToTransform();if(!b){GENTICS.Aloha.Log.error(this,"Could not transform selection into a list");return}}var c=b.nodeName.toLowerCase();if(c=="ul"&&!a){var d=jQuery(b),e=d.parent();if(e.length>0&&GENTICS.Utils.Dom.isListElement(e.get(0)))d.children().unwrap();else{var f=jQuery(b);jQuery.each(f.children("li"),function(a,b){var c=GENTICS.Aloha.Markup.transformDomObject(b,"p");c.after(c.children("ol,ul"))}),f.children().unwrap()}}else if(c=="ul"&&a)GENTICS.Aloha.Markup.transformDomObject(b,"ol"),this.mergeAdjacentLists(jQuery(b));else if(c=="ol"&&!a)GENTICS.Aloha.Markup.transformDomObject(b,"ul"),this.mergeAdjacentLists(jQuery(b));else if(c=="ol"&&a){var d=jQuery(b),e=d.parent();if(e.length>0&&GENTICS.Utils.Dom.isListElement(e.get(0)))d.children().unwrap();else{var f=jQuery(b);jQuery.each(f.children("li"),function(a,b){var c=GENTICS.Aloha.Markup.transformDomObject(b,"p");c.after(c.children("ol,ul"))}),f.children().unwrap()}}else{var g=GENTICS.Aloha.Selection.rangeObject.getSelectedSiblings(b),d=a?jQuery("<ol></ol>"):jQuery("<ul></ul>"),h=jQuery("<li></li>");d.append(h),jQuery(b).contents().appendTo(h),jQuery(b).replaceWith(d);if(g){var i=!1;for(var j=0;j<g.length;++j)if(GENTICS.Utils.Dom.isBlockLevelElement(g[j]))i&&(i=!1),h=GENTICS.Aloha.Markup.transformDomObject(g[j],"li"),d.append(h);else{if(g[j].nodeType==3&&jQuery.trim(g[j].data).length==0)continue;i||(i=jQuery("<li></li>"),d.append(i)),i.append(g[j])}}this.mergeAdjacentLists(d)}this.refreshSelection()},GENTICS.Aloha.ListPlugin.indentList=function(){var a=this.getNearestSelectedListItem();if(a){var b=jQuery(a).prev("li");if(b.length==0)return!1;var c=jQuery(a).parent(),d=GENTICS.Aloha.Selection.rangeObject.getSelectedSiblings(a),e=jQuery(a).parent().clone(!1).empty();e.append(a),b.append(e);if(d)for(var f=0;f<d.length;++f)e.append(jQuery(d[f]));return this.mergeAdjacentLists(e),this.refreshSelection(),!1}return!0},GENTICS.Aloha.ListPlugin.outdentList=function(){var a=this.getNearestSelectedListItem();if(a){var b=jQuery(a),c=b.parent(),d=c.parents("ul,ol"),e=c.parent("li");if(d.length>0&&GENTICS.Utils.Dom.isListElement(d.get(0))){var f=GENTICS.Aloha.Selection.rangeObject.getSelectedSiblings(a);if(f&&f.length>0)var g=jQuery(f[f.length-1]);else var g=b;if(g.nextAll("li").length>0){var h=c.clone(!1).empty();h.append(g.nextAll())}e.length>0?(typeof h!="undefined"&&b.append(h),e.after(b)):c.before(b);if(f&&f.length>0)for(var i=f.length-1;i>=0;--i)b.after(jQuery(f[i]));c.contents("li").length==0&&c.remove(),e.length>0&&e.contents().length==0&&e.remove(),this.refreshSelection()}return!1}return!0},GENTICS.Aloha.ListPlugin.refreshSelection=function(){GENTICS.Aloha.activeEditable&&GENTICS.Aloha.activeEditable.obj[0].focus(),GENTICS.Aloha.Selection.rangeObject.update(),GENTICS.Aloha.Selection.rangeObject.select(),GENTICS.Aloha.Selection.updateSelection()},GENTICS.Aloha.ListPlugin.mergeAdjacentLists=function(a){var b=a.get(0);while(b.previousSibling&&b.previousSibling.nodeType==1&&b.previousSibling.nodeName==b.nodeName)b=b.previousSibling;a=jQuery(b);while(b.nextSibling&&(b.nextSibling.nodeType==1&&b.nextSibling.nodeName==b.nodeName||b.nextSibling.nodeType==3&&jQuery.trim(b.nextSibling.data).length==0)){var c=jQuery(b.nextSibling);b.nextSibling.nodeType==1&&c.contents().appendTo(a),c.remove()}}