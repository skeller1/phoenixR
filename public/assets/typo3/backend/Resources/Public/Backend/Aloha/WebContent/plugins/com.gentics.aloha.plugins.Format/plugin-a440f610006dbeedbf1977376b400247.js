/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
/**
 * register the plugin with unique name
 */
GENTICS.Aloha.Format=new GENTICS.Aloha.Plugin("com.gentics.aloha.plugins.Format"),GENTICS.Aloha.Format.languages=["en","de","fr","eo","fi","ru","it","pl"],GENTICS.Aloha.Format.config=["b","i","del","sub","sup","p","title","h1","h2","h3","h4","h5","h6","pre","removeFormat"],GENTICS.Aloha.Format.init=function(){this.initButtons();var a=this;GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"editableActivated",function(b,c){a.applyButtonConfig(c.editable.obj)})},GENTICS.Aloha.Format.applyButtonConfig=function(a){config=this.getEditableConfig(a);for(var b in this.buttons)jQuery.inArray(b,config)!=-1?this.buttons[b].button.show():this.buttons[b].button.hide();for(var c in this.multiSplitItems)jQuery.inArray(this.multiSplitItems[c].name,config)!=-1?this.multiSplitButton.extButton.showItem(this.multiSplitItems[c].name):this.multiSplitButton.extButton.hideItem(this.multiSplitItems[c].name)},GENTICS.Aloha.Format.initButtons=function(){var a="GENTICS.Aloha.continuoustext";this.buttons={};var b=this;this.multiSplitItems=[],this.multiSplitButton,jQuery.each(GENTICS.Aloha.Format.config,function(c,d){switch(d){case"b":case"i":case"cite":case"q":case"code":case"abbr":case"del":case"sub":case"sup":b.buttons[d]={button:new GENTICS.Aloha.ui.Button({iconClass:"GENTICS_button GENTICS_button_"+d,size:"small",onclick:function(){GENTICS.Aloha.activeEditable&&GENTICS.Aloha.activeEditable.obj[0].focus();var a=jQuery("<"+d+"></"+d+">"),b=GENTICS.Aloha.Selection.rangeObject,c=b.findMarkup(function(){return this.nodeName.toLowerCase()==a.get(0).nodeName.toLowerCase()},GENTICS.Aloha.activeEditable.obj);return c?b.isCollapsed()?GENTICS.Utils.Dom.removeFromDOM(c,b,!0):GENTICS.Utils.Dom.removeMarkup(b,a,GENTICS.Aloha.activeEditable.obj):(b.isCollapsed()&&GENTICS.Utils.Dom.extendToWord(b),GENTICS.Utils.Dom.addMarkup(b,a)),b.select(),!1},tooltip:b.i18n("button."+d+".tooltip"),toggle:!0}),markup:jQuery("<"+d+"></"+d+">")},GENTICS.Aloha.FloatingMenu.addButton(a,b.buttons[d].button,GENTICS.Aloha.i18n(GENTICS.Aloha,"floatingmenu.tab.format"),1);break;case"p":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"pre":b.multiSplitItems.push({name:d,tooltip:b.i18n("button."+d+".tooltip"),iconClass:"GENTICS_button "+b.i18n("GENTICS_button_"+d),markup:jQuery("<"+d+"></"+d+">"),click:function(){GENTICS.Aloha.activeEditable&&GENTICS.Aloha.activeEditable.obj[0].focus(),GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<"+d+"></"+d+">"))}});break;case"removeFormat":b.multiSplitItems.push({name:d,text:b.i18n("button."+d+".text"),tooltip:b.i18n("button."+d+".tooltip"),iconClass:"GENTICS_button GENTICS_button_"+d,wide:!0,click:function(){GENTICS.Aloha.Format.removeFormat()}});break;default:GENTICS.Aloha.log("warn",this,'Button "'+d+'" is not defined')}}),this.multiSplitItems.length>0&&(this.multiSplitButton=new GENTICS.Aloha.ui.MultiSplitButton({items:this.multiSplitItems}),GENTICS.Aloha.FloatingMenu.addButton(a,this.multiSplitButton,GENTICS.Aloha.i18n(GENTICS.Aloha,"floatingmenu.tab.format"),3)),GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"selectionChanged",function(a,c){jQuery.each(b.buttons,function(a,b){for(var d=0;d<c.markupEffectiveAtStart.length;d++){var e=c.markupEffectiveAtStart[d];if(GENTICS.Aloha.Selection.standardTextLevelSemanticsComparator(e,b.markup)){b.button.setPressed(!0);var f=!0}}f||b.button.setPressed(!1)});if(b.multiSplitItems.length>0){var d=!1;for(var e=0;e<c.markupEffectiveAtStart.length&&!d;e++){var f=c.markupEffectiveAtStart[e];for(var g=0;g<b.multiSplitItems.length&&!d;g++){var h=b.multiSplitItems[g];if(!h.markup)continue;GENTICS.Aloha.Selection.standardTextLevelSemanticsComparator(f,h.markup)&&(b.multiSplitButton.setActiveItem(h.name),d=!0)}}d||b.multiSplitButton.setActiveItem(null)}})},GENTICS.Aloha.Format.removeFormat=function(){GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<p></p>"));var a=["b","i","cite","q","code","abbr","del","sub","sup"],b=GENTICS.Aloha.Selection.rangeObject,c=jQuery(b.startContainer),d=jQuery(b.limitObject);if(b.isCollapsed()||c===d)return;var e=c.parent();while(e.get(0)!==d.get(0)){var f=a.indexOf(e.get(0).nodeName.toLowerCase());e=e.parent(),f!=-1&&(GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<"+a[f]+"></"+a[f]+">")),a.splice(f,1))}for(var g in a)GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<"+a[g]+"></"+a[g]+">")),GENTICS.Aloha.Selection.changeMarkupOnSelection(jQuery("<"+a[g]+"></"+a[g]+">"))},GENTICS.Aloha.Format.toString=function(){return"com.gentics.aloha.plugins.Format"}