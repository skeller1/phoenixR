/*!
* Aloha Editor
* Author & Copyright (c) 2010 Gentics Software GmbH
* aloha-sales@gentics.com
* Licensed unter the terms of http://www.aloha-editor.com/license.html
*/
/**
 * register the plugin with unique name
 */
GENTICS.Aloha.Abbr=new GENTICS.Aloha.Plugin("com.gentics.aloha.plugins.Abbr"),GENTICS.Aloha.Abbr.languages=["en","de"],GENTICS.Aloha.Abbr.config=["abbr"],GENTICS.Aloha.Abbr.init=function(){this.createButtons(),this.subscribeEvents(),this.bindInteractions()},GENTICS.Aloha.Abbr.createButtons=function(){var a=this;this.formatAbbrButton=new GENTICS.Aloha.ui.Button({iconClass:"GENTICS_button GENTICS_button_abbr",size:"small",onclick:function(){a.formatAbbr()},tooltip:this.i18n("button.abbr.tooltip"),toggle:!0}),GENTICS.Aloha.FloatingMenu.addButton("GENTICS.Aloha.continuoustext",this.formatAbbrButton,GENTICS.Aloha.i18n(GENTICS.Aloha,"floatingmenu.tab.format"),1),this.insertAbbrButton=new GENTICS.Aloha.ui.Button({iconClass:"GENTICS_button GENTICS_button_abbr",size:"small",onclick:function(){a.insertAbbr(!1)},tooltip:this.i18n("button.addabbr.tooltip"),toggle:!1}),GENTICS.Aloha.FloatingMenu.addButton("GENTICS.Aloha.continuoustext",this.insertAbbrButton,GENTICS.Aloha.i18n(GENTICS.Aloha,"floatingmenu.tab.insert"),1),GENTICS.Aloha.FloatingMenu.createScope(this.getUID("abbr"),"GENTICS.Aloha.continuoustext"),this.abbrField=new GENTICS.Aloha.ui.AttributeField({width:320}),GENTICS.Aloha.FloatingMenu.addButton(this.getUID("abbr"),this.abbrField,this.i18n("floatingmenu.tab.abbr"),1)},GENTICS.Aloha.Abbr.bindInteractions=function(){var a=this;this.abbrField.addListener("blur",function(b,c){this.getValue()==""&&a.removeAbbr()});for(var b=0;b<GENTICS.Aloha.editables.length;b++)GENTICS.Aloha.editables[b].obj.keydown(function(b){if(b.metaKey&&b.which==71)return a.findAbbrMarkup()?(GENTICS.Aloha.FloatingMenu.userActivatedTab=a.i18n("floatingmenu.tab.abbr"),GENTICS.Aloha.FloatingMenu.doLayout(),a.abbrField.focus()):a.insertAbbr(),!1})},GENTICS.Aloha.Abbr.subscribeEvents=function(){var a=this;GENTICS.Aloha.EventRegistry.subscribe(GENTICS.Aloha,"selectionChanged",function(b,c){if(GENTICS.Aloha.activeEditable){var d=a.getEditableConfig(GENTICS.Aloha.activeEditable.obj);if(jQuery.inArray("abbr",d)!=-1)a.formatAbbrButton.show(),a.insertAbbrButton.show();else{a.formatAbbrButton.hide(),a.insertAbbrButton.hide();return}var e=a.findAbbrMarkup(c);e?(a.insertAbbrButton.hide(),a.formatAbbrButton.setPressed(!0),GENTICS.Aloha.FloatingMenu.setScope(a.getUID("abbr")),a.abbrField.setTargetObject(e,"title")):(a.formatAbbrButton.setPressed(!1),a.abbrField.setTargetObject(null)),GENTICS.Aloha.FloatingMenu.doLayout()}})},GENTICS.Aloha.Abbr.findAbbrMarkup=function(a){if(typeof a=="undefined")var a=GENTICS.Aloha.Selection.getRangeObject();return GENTICS.Aloha.activeEditable?a.findMarkup(function(){return this.nodeName.toLowerCase()=="abbr"},GENTICS.Aloha.activeEditable.obj):null},GENTICS.Aloha.Abbr.formatAbbr=function(){var a=GENTICS.Aloha.Selection.getRangeObject();GENTICS.Aloha.activeEditable&&(this.findAbbrMarkup(a)?this.removeAbbr():this.insertAbbr())},GENTICS.Aloha.Abbr.insertAbbr=function(a){if(this.findAbbrMarkup(b))return;GENTICS.Aloha.FloatingMenu.userActivatedTab=this.i18n("floatingmenu.tab.abbr");var b=GENTICS.Aloha.Selection.getRangeObject();b.isCollapsed()&&a!=!1&&GENTICS.Utils.Dom.extendToWord(b);if(b.isCollapsed()){var c=this.i18n("newabbr.defaulttext"),d=jQuery('<abbr title="">'+c+"</abbr>");GENTICS.Utils.Dom.insertIntoDOM(d,b,jQuery(GENTICS.Aloha.activeEditable.obj)),b.startContainer=b.endContainer=d.contents().get(0),b.startOffset=0,b.endOffset=c.length}else{var d=jQuery('<abbr title=""></abbr>');GENTICS.Utils.Dom.addMarkup(b,d,!1)}b.select(),this.abbrField.focus()},GENTICS.Aloha.Abbr.removeAbbr=function(){var a=GENTICS.Aloha.Selection.getRangeObject(),b=this.findAbbrMarkup();b&&(GENTICS.Utils.Dom.removeFromDOM(b,a,!0),GENTICS.Aloha.activeEditable.obj[0].focus(),a.select())},GENTICS.Aloha.Abbr.makeClean=function(a){}